<clr-modal [(clrModalOpen)]="createEditRuleOpened" [clrModalStaticBackdrop]="true" [clrModalClosable]="false">
    <h3 class="modal-title">{{headerTitle | translate}}</h3>
    <hbr-inline-alert class="modal-title" (confirmEvt)="confirmCancel($event)"></hbr-inline-alert>
    <div class="modal-body modal-body-height">
      <clr-alert [hidden]='!deletedLabelCount' [clrAlertType]="'alert-warning'" [clrAlertSizeSmall]="true" [clrAlertClosable]="false"
        [(clrAlertClosed)]="alertClosed">
        <div class="alert-item">
          <span class="alert-text">{{deletedLabelInfo}}</span>
          <div class="alert-actions">
            <a class="alert-action" (click)=" alertClosed = true">{{'REPLICATION.ACKNOWLEDGE' | translate}}</a>
          </div>
        </div>
      </clr-alert>
      <form [formGroup]="ruleForm" novalidate>
        <section class="form-block">
          <div class="form-group form-group-override">
            <label class="form-group-label-override required">{{'REPLICATION.NAME' | translate}}</label>
            <label aria-haspopup="true" role="tooltip" class="tooltip tooltip-validation tooltip-md tooltip-bottom-left" [class.invalid]='(ruleForm.controls.name.touched && ruleForm.controls.name.invalid) || !isRuleNameValid'>
              <input type="text" id="ruleName" pattern="^[a-z0-9]+(?:[._-][a-z0-9]+)*$" class="inputWidth" required maxlength="255" formControlName="name"
                #ruleName (keyup)='checkRuleName()' autocomplete="off">
              <span class="tooltip-content">{{ruleNameTooltip | translate}}</span>
            </label>
            <span class="spinner spinner-inline spinner-pos" [hidden]="!inNameChecking"></span>
          </div>
          <!--Description-->
          <div class="form-group form-group-override">
            <label class="form-group-label-override">{{'REPLICATION.DESCRIPTION' | translate}}</label>
            <textarea type="text" id="ruleDescription" class="inputWidth" row=3 formControlName="description"></textarea>
          </div>
          <!-- replication mode -->
          <div class="form-group form-group-override">
            <label class="form-group-label-override">Replication mode</label>
            <div class="radio" style="display:inherit;">
              <input type="radio" value="push" id="push_base" name="replicationMode" [value]=true [(ngModel)]="isPushMode" [ngModelOptions]="{standalone: true}">
              <label for="push_base">Push-based</label>
              <input type="radio" value="pull" id="pull_base" name="replicationMode" [value]=false [(ngModel)]="isPushMode" [ngModelOptions]="{standalone: true}">
              <label for="pull_base">Pull-based</label>
            </div>
          </div>
          <!--source registry-->
          <div class="form-group form-group-override">
            <label class="form-group-label-override  required">Source Registry</label>
            <div formArrayName="sources" class="form-select">
              <div class="select endpointSelect pull-left" *ngFor="let source of sources.controls; let i= index" [formGroupName]="i">
                <select id="sourceRegistry" (change)="sourceChange($event)" formControlName="id">
                  <option *ngFor="let source of sourceList" value="{{source.id}}">{{source.name}}-{{source.url}}</option>
                </select>
              </div>
            </div>
            <label *ngIf="noEndpointInfo.length != 0" class="colorRed alertLabel">{{noEndpointInfo | translate}}</label>
            <span class="alertLabel goLink" *ngIf="noEndpointInfo.length != 0" (click)="goRegistry()">{{'REPLICATION.ENDPOINTS' | translate}}</span>
          </div>
          <!--source namespace -->
          <div class="form-group form-group-override">
            <label class="form-group-label-override  required">Source Namespace</label>
            <div  class="form-select">
              <div class="select endpointSelect pull-left">
                  <input type="text" formControlName="sourceNamespace" id="sourceNamespace" pattern="^[a-z0-9]+(?:[._-][a-z0-9]+)*$" class="inputWidth" required maxlength="255">
              </div>
            </div>
          </div>
          <!--images/Filter-->
          <div class="form-group form-group-override">
            <label class="form-group-label-override">{{'REPLICATION.SOURCE_IMAGES_FILTER' | translate}}</label>
            <div formArrayName="filters">
              <div class="filterSelect" *ngFor="let filter of filters.controls; let i=index">
                <div [formGroupName]="i">
                  <div class="select floatSetPar">
                    <select formControlName="kind" #selectedValue (change)="filterChange($event, selectedValue.value)" id="{{i}}" name="{{filterListData[i]?.name}}">
                      <option *ngFor="let opt of filterListData[i]?.options;" value="{{opt}}">{{opt}}</option>
                    </select>
                  </div>
                  <label aria-haspopup="true" role="tooltip" class="tooltip tooltip-validation tooltip-md tooltip-bottom-left" [class.invalid]='(filter.value.dirty || filter.value.touched) && filter.value.invalid'>
                    <input type="text" #filterValue required size="14" formControlName="value" [attr.disabled]="(filterListData[i]?.name=='label') ?'' : null">
                    <span class="tooltip-content">{{'TOOLTIP.EMPTY' | translate}}</span>
                  </label>
                  <div class="arrowSet" [hidden]="!(filterListData[i]?.name=='label')" (click)="openLabelList(selectedValue.value, i, $event)">
                    <clr-icon shape="angle"></clr-icon>
                  </div>
                  <clr-icon shape="warning-standard" class="is-solid is-warning warning-icon" size="14" [hidden]="!deletedLabelCount || !(filterListData[i]?.name=='label')"></clr-icon>
                  <clr-icon shape="times-circle" class="is-solid" (click)="deleteFilter(i)"></clr-icon>
                  <div *ngIf="!withAdmiral">
                    <hbr-filter-label [projectId]="projectId" [selectedLabelInfo]="filterLabelInfo" [isOpen]="filterListData[i].isOpen" (selectedLabels)="selectedLabelList($event, i)"
                      (closePanelEvent)="filterListData[i].isOpen = false"></hbr-filter-label>
                  </div>
                </div>
              </div>
  
            </div>
            <clr-icon id="add-label-list" shape="plus-circle" class="is-solid plus-position" [hidden]="isFilterHide" (click)="addNewFilter()"></clr-icon>
  
          </div>
          <!--destination registry-->
          <div class="form-group form-group-override">
  
            <label class="form-group-label-override  required">Destination Registry</label>
            <div formArrayName="targets" class="form-select">
              <div class="select endpointSelect pull-left" *ngFor="let target of targets.controls; let i= index" [formGroupName]="i">
                <select id="ruleTarget" (change)="targetChange($event)" formControlName="id">
                  <option *ngFor="let target of targetList" value="{{target.id}}">{{target.name}}-{{target.url}}</option>
                </select>
              </div>
            </div>
            <label *ngIf="noEndpointInfo.length != 0" class="colorRed alertLabel">{{noEndpointInfo | translate}}</label>
            <span class="alertLabel goLink" *ngIf="noEndpointInfo.length != 0" (click)="goRegistry()">{{'REPLICATION.ENDPOINTS' | translate}}</span>
          </div>
          <!--destination namespaces -->
          <div class="form-group form-group-override">
            <label class="form-group-label-override">Destination Namespaces</label>
            <div class="form-select">
              <div class="select endpointSelect pull-left">
                <input formContrlName="destinationNamespace" type="text" id="destinationNamespace" pattern="^[a-z0-9]+(?:[._-][a-z0-9]+)*$" class="inputWidth" maxlength="255">
              </div>
            </div>
          </div>
  
          <!--Trigger-->
          <div class="form-group form-group-override">
            <label class="form-group-label-override">{{'REPLICATION.TRIGGER_MODE' | translate}}</label>
            <div formGroupName="trigger">
              <!--on trigger-->
              <div class="select floatSetPar">
                <select id="ruleTrigger" formControlName="kind" (change)="selectTrigger($event)">
                  <option value="Manual">{{'REPLICATION.MANUAL' | translate}}</option>
                  <option value="Immediate">{{'REPLICATION.IMMEDIATE' | translate}}</option>
                  <option value="Scheduled">{{'REPLICATION.SCHEDULE' | translate}}</option>
                </select>
              </div>
              <!--on push-->
              <div formGroupName="schedule_param">
                <div [hidden]="!isScheduleOpt">
                  <label>Cron String</label> 
                  <label for="targetCron" aria-haspopup="true" role="tooltip" class="tooltip tooltip-validation tooltip-md tooltip-top-right">
                    <input type="text" name=targetCron id="targetCron" required class="form-control cron-input" formControlName="cron">
                    <span class="tooltip-content">
                      {{'TOOLTIP.CRON_REQUIRED' | translate }}
                    </span>
                  </label>
                </div>
              </div>
            </div>
            <div [hidden]="!isImmediate" class="clr-form-control rule-width">
              <clr-checkbox-wrapper>
                <input type="checkbox" clrCheckbox [checked]="false" id="ruleDeletion" formControlName="replicate_deletion" class="clr-checkbox">
                <label for="ruleDeletion" class="clr-control-label">{{'REPLICATION.DELETE_REMOTE_IMAGES' | translate}}</label>
              </clr-checkbox-wrapper>
            </div>
            <div class="clr-form-control rule-width">
              <clr-checkbox-wrapper>
                <input type="checkbox" clrCheckbox [checked]="true" id="ruleExit" formControlName="replicate_existing_image_now" class="clr-checkbox">
                <label for="ruleExit" class="clr-control-label">{{'REPLICATION.REPLICATE_IMMEDIATE' | translate}}</label>
              </clr-checkbox-wrapper>
            </div>
          </div>
          <div class="loading-center">
            <span class="spinner spinner-inline" [hidden]="inProgress === false"></span>
          </div>
        </section>
      </form>
    </div>
    <div class="modal-footer">
      <button type="button" id="ruleBtnCancel" class="btn btn-outline" [disabled]="this.inProgress" (click)="onCancel()">{{ 'BUTTON.CANCEL' | translate }}</button>
      <button type="submit" id="ruleBtnOk" class="btn btn-primary" (click)="onSubmit()" [disabled]="!ruleForm.valid || !isValid || !hasFormChange()">{{ 'BUTTON.SAVE' | translate }}</button>
    </div>
  </clr-modal>